@import play.api.libs.json.JsValue
@import play.api.libs.json.Json
@import models.api._

@import models.domain.DataSourceDescription
@import models.domain.DonationDataSourceType.DonationDataSourceType

@(donorId: String, data: Map[String, GraphData])(implicit request: RequestHeader, messages: Messages)

@mainNew("DonaForMe")() {
    <div class="justify-content-center">
        <div class="top col-md text-center">
            <span class="headline font-italic text-center"><strong>@messages("feedback.thanks.title")</strong></span>
        </div>

        @for((dataSource, GraphData(_, _, _, _, _, _, _, _, _, _, _, averageMessageNumber, _)) <- data) {
            <div id="@{
                dataSource.toString
            }container">
                @showStatistics(averageMessageNumber, dataSource)
                @showAnimatedPolarPlot(dataSource)
                @showAnimatedHorizontalBarChart(dataSource)
                @showDailyActivityTimes(dataSource)
                @showResponseTimeBarChart(dataSource)
            </div>
        }

    </div>
    <script src="@routes.Assets.at("lib/jquery/jquery.min.js")" type="text/javascript"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script> const allData = @Html(Json.stringify(Json.toJson(data)));</script>
    <script> const i18n = {
        time: "@messages("feedback.graph.time")",
        numberOfMessages: "@messages("feedback.graph.number-of-messages")",
        sent: "@messages("feedback.graph.sent")",
        received: "@messages("feedback.graph.received")",
        responseTime: "@messages("feedback.graph.response-time")",
        medianResponseTime: "@messages("feedback.graph.median-response-time")",
        overview: "@messages("feedback.graph.overview")",
        detail: "@messages("feedback.graph.detail")",
        you: "@messages("feedback.graph.you")",
        friends: "@messages("feedback.graph.friends")"

    };
    </script>
    <script> const backGroundImages = {
        polarBackground: "@routes.Assets.at("images/FeedbackBackgroundForPolarPlot.svg")",
    };
    </script>
    <script src="@routes.Assets.at("javascripts/plot.js")" type="text/javascript"></script>
} {
}


@showAnimatedPolarPlot(name: String) = {
@showExplanationText("Animated Polar Plot", "This graph displays you as the big yellow dot in the middle. Around you are smaller white dots for your different chats. The more words were written in a chat in the below displayed month, the closer the white dot gets to the middle where you are. The white dots' movement over time always leaves a smaller transparent dot where they were before. So, you can see a trace of the dots' motion in the past months. With the start and pause buttons next to the time slider below the graph, you can start and pause the animation going through the months. You can also use the time slider to go through the months yourself."
        + "Click HERE to see an example with explanations (TODO)."
)

    <div id="@{
        name.toString
    }AnimatedPolarPlot" class="d-none"
    data-x-axis="@messages("feedback.graph.time")"
    data-y-axis="@messages("feedback.graph.number-of-messages")"
    data-sent-trace-name="@messages("feedback.graph.sent")"
    data-received-trace-name="@messages("feedback.graph.received")"
    >
        <div class="card h-100">
            <div class="m-auto">@messages("feedback.graph.loading")</div>
        </div>
    </div>
    <div class="clearfix"></div>
}

@showAnimatedHorizontalBarChart(name: String) = {
@showExplanationText("Animated Horizontal Bar Chart",
    "Here you can see the amount of words you sent in your different conversations adding up per month. You can use the slider below to go through the months. Click HERE to see an example with explanations (TODO)"
)
    <div
    id="@{
        name.toString
    }AnimatedHorizontalBarChart"
    class="d-none"
    data-x-axis="@messages("feedback.graph.time")"
    data-y-axis="@messages("feedback.graph.number-of-messages")"
    data-sent-trace-name="@messages("feedback.graph.sent")"
    data-received-trace-name="@messages("feedback.graph.received")"
    >
        <div class="card h-100">
            <div class="m-auto">@messages("feedback.graph.loading")</div>
        </div>
    </div>
    <div class="top col-md text-right pt-2">
        <div class="modal fade" id="@{
            name.toString
        }sentReceivedModal" role="dialog">
        @feedback_sentReceivedPlotsModal(name, data)
        </div>
        <button class="btn btn-outline footer-forward-button text-center" data-toggle="modal" data-target="#@{
            name.toString
        }sentReceivedModal">
            More about sent/received</button>
    </div>
    <div class="clearfix"></div>
}


@showDailyActivityTimes(name: String) = {

@showExplanationText("Daily Activity Plot",
    "In this plot you can see in which hours of the day you were active for the whole time span of the data you donated. On the vertical axis the hours of the day are displayed for each day on the horizontal axis. Per hour there is one square if you at least sent one word in that hour. As you can see on the colorscale on the right, if a square has a dark color, you sent less words in that hour than in your average hour. If the color is bright, then you sent more words than in the average case. If you want to look closer at a specific time span you can zoom in by clicking on the graph and holding while you move your mouse to the left or the right to produce the time window you want to zoom into. Click HERE to see an example with explanations (TODO)"
)

    <div id="@{
        name
    }DailyActivityTimes" class="d-none"
    data-x-axis="@messages("feedback.graph.time")"
    data-y-axis="@messages("feedback.graph.number-of-messages")"
    data-sent-trace-name="@messages("feedback.graph.sent")"
    data-received-trace-name="@messages("feedback.graph.received")"
    >
        <div class="card h-100">
            <div class="m-auto">@messages("feedback.graph.loading")</div>
        </div>
    </div>

    <div class="top col-md text-right">
        <div class="modal fade" id="@{
            name
        }dailyActivityModal" role="dialog">
        @feedback_dailyActivityPlotsModal(name)
        </div>
        <button class="btn btn-outline footer-forward-button text-center" data-toggle="modal" data-target="#@{
            name
        }dailyActivityModal">
            More about daily activity times</button>
    </div>

    <div class="clearfix"></div>
}


@showResponseTimeBarChart(name: String) = {
@showExplanationText("Response Time Bar Chart",
    "Here over the whole time span of the data that you donated your and your friends response times are counted. So, the percentage of all responses (i.e. a message that you sent after a message of a friend or the other way around) that took place in the specified amount of time is displayed. You can see how many of your responses you sent quicker than after 1 minute, after 1-2 minutes, 3-5 minutes, 6-15 minutes, 16-30 minutes, 31-60 minutes and slower than 60 minutes. The bar for > 60 minutes includes longer breaks in conversation. Click HERE to see an example with explanations (TODO)")


    <div id="@{
        name
    }ResponseTimeBarChart"></div>
    <div class="top col-md text-right pt-2">
        <div class="modal fade" id="@{
            name.toString
        }responseTimeModal" role="dialog">
        @feedback_responseTimePlotsModal(name, data)
        </div>
        <button class="btn btn-outline footer-forward-button text-center" data-toggle="modal" data-target="#@{
            name.toString
        }responseTimeModal">
            More about response times</button>
    </div>
    <div class="clearfix"></div>
}


@showExplanationText(title: String, body: String) = {
    <div class="top">
        <h4 class="text-center font-weight-bold insights-header">@title</h4>
    </div>
    <div class="card-deck feedback-stats-deck">
        <div class="modal fade" id="testing" role="dialog">
            @feedback_explanationModal("testing")
        </div>

        <div class="card top feedback-stats-card">
            <p class="insights-text text-center">
            @body
                <a href="#testing" data-toggle="modal" data-target="#testing">SHOW EXAMPLE</a>
            </p>
        </div>

    </div>
}


@showStatistics(averageNumberOfMessages: AverageNumberOfMessages, dataSource: String) = {
    <div class="top">
        <h4 class="text-center font-weight-bold insights-header">@String.format(messages("feedback.graph.title"), dataSource)</h4>
    </div>
    <div>
        Maybe also make this text part more "interactive" -> per conversation (and overall) show data for: daily, weekly, monthly, yearly... And more Infos: Hoy many media files</div>
    <div class="card-deck feedback-stats-deck">
        <div class="card top feedback-stats-card">
            <h3 class="insights-title text-center">@messages("feedback.graph.total-messages")</h3>
            <p class="insights-text text-center">
            @String.format(
                messages("feedback.graph.active-years-explanation_format"),
                averageNumberOfMessages.numberOfActiveYears.toString
            )
            </p>
            <div class="container">
                <div class="row">
                    <div class="col-6">
                        <div class="text-left insights-box-white" align="center">
                            <h3 class="insights-message-number">@averageNumberOfMessages.sentTotal</h3>
                            <span class="insights-body">@messages("feedback.graph.messages").toUpperCase</span>
                        </div>
                        <span class="insights-caption">@messages("feedback.graph.sent")</span>
                    </div>
                    <div class="col-6">
                        <div class="text-left insights-box-blue">
                            <h3 class="insights-message-number">@averageNumberOfMessages.receivedTotal</h3>
                            <span class="insights-body">@messages("feedback.graph.messages").toUpperCase</span>
                        </div>
                        <span class="insights-caption">@messages("feedback.graph.received")</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="card top feedback-stats-card thanks-small-screen-margin">
            <h3 class="insights-title text-center">@messages("feedback.graph.average-per-active-month")</h3>
            <p class="insights-text text-center"> @String.format(messages("feedback.graph.active-months-explanation_format"), averageNumberOfMessages.numberOfActiveMonths.toString)</p>
            <div class="container">
                <div class="row">
                    <div class="col-6">
                        <div class="text-left insights-box-white">
                            <h3 class="insights-message-number">@averageNumberOfMessages.sentPerActiveMonth</h3>
                            <span class="insights-body">@messages("feedback.graph.messages").toUpperCase</span>
                        </div>
                        <span class="insights-caption" >@messages("feedback.graph.sent")</span>
                    </div>
                    <div class="col-6">
                        <div class="text-left insights-box-blue">
                            <h3 class="insights-message-number">@averageNumberOfMessages.receivedPerActiveMonth</h3>
                            <span class="insights-body">@messages("feedback.graph.messages").toUpperCase</span>
                        </div>
                        <span class="insights-caption">@messages("feedback.graph.received")</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
}
